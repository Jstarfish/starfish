<!DOCTYPE html>
<html>
	<head>
		<!-- Standard Meta -->
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

		<!-- Vendor Specific -->
		<!-- Set renderer engine for 360 browser -->
		<meta name="renderer" content="webkit">

		<!-- Cache Meta -->
		<meta http-equiv="Expires" content="0">
		<meta http-equiv="Cache-Control" content="no-cache">
		<meta http-equiv="Pragma" content="no-cache">

		<!-- Style Sheet -->
		<link rel="stylesheet" href="../static/lib/jquery/jquery-ui.css" />
		<link rel="stylesheet" href="../static/lib/qtip/jquery.qtip.css" />
		<link rel="stylesheet" href="../static/css/common/basic.css" />
		<link rel="stylesheet" href="../static/css/libext/jquery.ext.css" />
		<link rel="stylesheet" href="../static/css-app/app.css" />
		<link rel="stylesheet" href="../static/css/libext/toolbar.css" />
		<!--[if lt IE 9]>
		<script type="text/javascript" src="../static/js/html5/html5shiv.js"></script>
		<![endif]-->

		<!-- script here -->
		<script type="text/javascript" src="../static/lib/jquery/jquery.js"></script>
		<script type="text/javascript" src="../static/lib/jquery/jquery-migrate.min.js"></script>
		<script type="text/javascript" src="../static/lib/jquery/jquery-ui.js"></script>
		<script type="text/javascript" src="../static/lib/jquery/jquery.locale-cn.js"></script>
		<script type="text/javascript" src="../static/lib/qtip/jquery.qtip.js"></script>
		<script type="text/javascript" src="../static/lib/layer/layer.js"></script>
		<script type="text/javascript" src="../static/lib/layer/extend/layer.ext.js"></script>
		<script type="text/javascript" src="../static/js/common/laytpl.js"></script>
		<script type="text/javascript" src="../static/js/common/common.js"></script>
		<script type="text/javascript" src="../static/js/libext/layer.ext.js"></script>
		<script type="text/javascript" src="../static/js/libext/jquery.ext.js"></script>
		<script type="text/javascript" src="../static/js/libext/toolbar.js"></script>

		<title>工具栏</title>

		<style type="text/css">
			.page.segment {
				width: 940px;
				height: auto;
				border: 1px solid gray;
				margin: 0px auto;
				padding: 0;
				position: relative;
			}
			.topToolBarWrapper {
				width: 100%;
				position: relative;
				top: 0;
				height: 34px;
				line-height: 34px;
				background-color: #eee;
				color: blue;
				padding: 0;
			}

			.topToolBarWrapper.fixed {
				position: fixed;
				z-index: 9990;
			}
			.topToolBar {
				width: 940px;
				height: 100%;
				margin: 0px auto;
				position: relative;
				background-color: yellow;
				border: 1px solid gray;
			}

			.floorBarWrapper {
				position: fixed;
				z-index: 9992;
				top: 0;
				left: 0;
				width: 0px;
				height: 100%;
				background-color: #7a6e6e;
				font-size: 12px;
			}

			.floorBar {
				list-style: none;
				padding: 0;
				position: absolute;
				width: 34px;
				top: 50%;
				margin-top: -100px;
				overflow: hidden;
				cursor: pointer;
			}
			.floorBar > li {
				display: block;
				height: 34px;
				line-height: 34px;
				text-align: center;
				border-bottom: 1px solid #EFEFEF;
			}

			.floorBar > li > a {
				display: block;
			}

			.floorBar > li > a.name {
				display: none;
				color: #b61d1d;
			}
			.floorBar > li.current > a.code {
				display: none;
			}
			.floorBar > li.current > a.name {
				display: block;
			}
			.floorBar > li.hover > a.code {
				display: none;
			}
			.floorBar > li.hover > a.name {
				display: block;
				color: #FFF;
				background-color: #b61d1d;
			}

		</style>
	</head>

	<body>
		<div class="topToolBarWrapper"></div>
		<div class="topToolBarWrapper fixed">
			<div class="topToolBar">
				<span id="logText">aaaaaaaaa</span>
			</div>
		</div>

		<div class="floorBarWrapper">
			<ul class="floorBar">
				<li>
					<a class="code">1F</a>
					<a class="name">服饰</a>
				</li>
				<li class="current">
					<a class="code">2F</a>
					<a class="name">美妆</a>
				</li>
				<li>
					<a class="code">3F</a>
					<a class="name">手机</a>
				</li>
				<li>
					<a class="code">4F</a>
					<a class="name">家电</a>
				</li>
				<li class="hover">
					<a class="code">5F</a>
					<a class="name">数码</a>
				</li>
				<li>
					<a class="code">6F</a>
					<a class="name">运动</a>
				</li>
			</ul>
		</div>
		<div id="rightToolBarWrapper"></div>

		<div class="page segment">
			<div class="align center tracked" style="height:40px;line-height:40px;background-color: #EEE">
				<span style="float:left;padding-left: 10px;">1 楼</span>模拟京东等首页效果
			</div>
			<ul id="list-1" class="fluid list"></ul>
			<br/>
			<div class="align center tracked" style="height:40px;line-height:40px;background-color: #EEE">
				<span style="float:left;padding-left: 10px;">2 楼</span>模拟京东等首页效果
			</div>
			<ul id="list-2" class="fluid list"></ul>
			<div class="align center tracked" style="height:40px;line-height:40px;background-color: #EEE">
				<span style="float:left;padding-left: 10px;">3 楼</span>模拟京东等首页效果
			</div>
			<ul id="list-3" class="fluid list"></ul>
			<div class="align center tracked" style="height:40px;line-height:40px;background-color: #EEE">
				<span style="float:left;padding-left: 10px;">4 楼</span>模拟京东等首页效果
			</div>
			<ul id="list-4" class="fluid list"></ul>
			<div class="align center tracked" style="height:40px;line-height:40px;background-color: #EEE">
				<span style="float:left;padding-left: 10px;">5 楼</span>模拟京东等首页效果
			</div>
			<ul id="list-5" class="fluid list"></ul>
			<div class="align center tracked" style="height:40px;line-height:40px;background-color: #EEE">
				<span style="float:left;padding-left: 10px;">6 楼</span>模拟京东等首页效果
			</div>
			<ul id="list-6" class="fluid list"></ul>
		</div>

		<script type="text/javascript">
			var sampleImageList = [{
				name : "ohoopee1",
				fileBrowseUrl : "../static/tmp-images/ohoopee1.jpg"
			}, {
				name : "ohoopee2",
				fileBrowseUrl : "../static/tmp-images/ohoopee2.jpg"
			}, {
				name : "ohoopee3",
				fileBrowseUrl : "../static/tmp-images/ohoopee3.jpg"
			}, {
				name : "bmw_m1_hood",
				fileBrowseUrl : "http://www.appelsiini.net/projects/lazyload/img/bmw_m1_hood.jpg"
			}, {
				name : "bmw_m1_side",
				fileBrowseUrl : "http://www.appelsiini.net/projects/lazyload/img/bmw_m1_side.jpg"
			}, {
				name : "viper_1",
				fileBrowseUrl : "http://www.appelsiini.net/projects/lazyload/img/viper_1.jpg"
			}, {
				name : "viper_corner",
				fileBrowseUrl : "http://www.appelsiini.net/projects/lazyload/img/viper_corner.jpg"
			}, {
				name : "bmw_m3_gt",
				fileBrowseUrl : "http://www.appelsiini.net/projects/lazyload/img/bmw_m3_gt.jpg"
			}];

			function renderImageList(list) {
				var tplHtml = $id("imageItemTpl").html();
				var htmlTpl = laytpl(tplHtml);
				//
				var jqList = $(list);
				jqList.empty();
				//
				for (var i = 0, j = sampleImageList.length; i < j; i++) {
					var liData = sampleImageList[i];
					var liHtml = htmlTpl.render(liData);
					var liDom = $(liHtml).appendTo(jqList);
					var jqLi = $(liDom);
					var index = i;
					//使用闭包做法
					var handler = function() {
						//构造环境保持数据
						var liDataX = liData;
						var indexX = index;
						return function() {
							console.log("使用闭包>> " + (indexX + 1) + " >> " + JSON.encode(liDataX));
						};
					}();
					jqLi.on("dblclick", handler);

					//不用闭包做法
					jqLi.data("liData", liData);
					jqLi.data("index", index);
					jqLi.on("dblclick", function() {
						var indexX = $(this).data("index");
						var liDataX = $(this).data("liData");
						console.log("不用闭包>> " + (indexX + 1) + " >> " + JSON.encode(liDataX));
					});
				}
			}

			function adjustCtrlsPosition(winWith, winHeight) {
				var jqTopToolBar = $(".topToolBar");
				//
				var jqFloorBarWrapper = $(".floorBarWrapper");
				var jqFloorBar = jqFloorBarWrapper.find(">.floorBar");
				jqFloorBarWrapper.css("left", (winWith - jqTopToolBar.width()) / 2 - jqFloorBar.width() - 2);
				jqFloorBar.css("margin-top", -1 * (jqFloorBar.height() / 2));
			}

			function refreshFloorBar() {
				//var docScrollTop = $(document.body).scrollTop();
				var docScrollTop = $(window).scrollTop();
				var jqRefCtrl = $id("list-1");
				var refTop = jqRefCtrl.offset().top;
				var top = docScrollTop + refTop;
				var btm = top + jqRefCtrl.height();
				var text = top + " -> " + btm;
				$id("logText").text(text);
				console.log(text);
			}
			
			function ScrollTracker() {
				var THIS = this;
				var failureFlagClass = ".tracked";
				var jqElems = [];
				var jqView = $(document);
				//
				this.track = function(elems) {
					var tmpElems = $id(elems);
					tmpElems.each(function() {
						var jqElem = $(this);
						jqElems.add(jqElem);
					});
				};
				this.inView = function(view) {
					view = view || document;
					jqView = $id(view);
				};
				//
				this.start = function() {
					if (jqElems.length == 0) {
						this.track(jqView.find(failureFlagClass));
					}
					//
				};
				//
				return this;
			}

			//
			ScrollTracker.newOne = function() {
				return new ScrollTracker();
			};
			
			var scrollTracker = ScrollTracker.newOne();
			//
			var rightToolBar = null;
			function renderRightToolbar() {
				rightToolBar = new RightToolBar("#rightToolBarWrapper");
				rightToolBar.addMidButton({
					name : "cart",
					text : "购物车",
					hint : true,
					iconClass : "cart",
					showHandler : rightToolBarShowHandler,
					clickHandler : rightToolBarClickHandler
				});
				rightToolBar.addMidButton({
					name : "attention",
					text : "我的关注",
					hint : true,
					iconClass : "favor",
					clickHandler : rightToolBarClickHandler
				});
				//
				rightToolBar.addBtmButton({
					name : "toTop",
					text : "回顶部",
					iconClass : "toTop",
					clickHandler : rightToolBarClickHandler
				});
				rightToolBar.addBtmButton({
					name : "feedback",
					text : "反馈",
					iconClass : "feedback",
					clickHandler : rightToolBarClickHandler
				});
				rightToolBar.addBtmButton({
					name : "survey",
					text : "有奖调查",
					fixed : true,
					clickHandler : rightToolBarClickHandler
				});
			}
			//
			function rightToolBarClickHandler(btnName) {
				if(btnName == "toTop"){
					$("body").scrollTop(0);
				}
				else {
					//
					Layer.msgInfo("点击的是：" + btnName);
				}
			}
			function rightToolBarShowHandler(btnName) {
				if(btnName == "cart"){
					rightToolBar.setActionText(btnName, "购物车（3/4）");
				}
				//
				console.log("Over的是：" + btnName);
			}
			
			function addProductToCart(btn) {
				var jqSrc = $(btn).parents("li");
				rightToolBar.transToButtonFrom("cart", jqSrc, function() {
					rightToolBar.setButtonHint("cart", "5");
				});
			}

			$(function() {
				//
				renderRightToolbar();
				//
				renderImageList($id("list-1"));
				renderImageList($id("list-2"));
				renderImageList($id("list-3"));
				renderImageList($id("list-4"));
				renderImageList($id("list-5"));
				renderImageList($id("list-6"));
				//
				winSizeMonitor.start(adjustCtrlsPosition);
				//
				refreshFloorBar();
				$(document).scroll(refreshFloorBar);
				//
				scrollTracker.start();
			});
		</script>
	</body>
	<script type="text/html" id="imageItemTpl">
		{{# var itemData = d; }}
		<li>
		<img class="content" src="{{ itemData.fileBrowseUrl }}"/>
		<div style="width:210px;height:24px;line-height:24px;text-align: center;cursor:default;">{{itemData.name}}</div>
		<div style="width:210px;height:24px;line-height:24px;text-align: center;cursor:default;border-top:1px dotted gray;background-color: #FFFF00"><a href="javascript:;" onclick="addProductToCart(this);">加入购物车</a></div>
		</li>
	</script>
</html>
